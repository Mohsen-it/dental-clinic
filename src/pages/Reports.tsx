import React, { useState, useEffect } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Badge } from '@/components/ui/badge'

import { useReportsStore } from '@/store/reportsStore'
import { useSettingsStore } from '@/store/settingsStore'
import { usePaymentStore } from '@/store/paymentStore'
import { useAppointmentStore } from '@/store/appointmentStore'
import { useInventoryStore } from '@/store/inventoryStore'
import { usePatientStore } from '@/store/patientStore'
import { useClinicNeedsStore } from '@/store/clinicNeedsStore'
import { useLabOrderStore } from '@/store/labOrderStore'
import { useRealTimeReports } from '@/hooks/useRealTimeReports'
import useTimeFilteredStats from '@/hooks/useTimeFilteredStats'
import { formatCurrency, formatDate } from '@/lib/utils'
import { getCardStyles, getIconStyles } from '@/lib/cardStyles'
import PatientReports from '@/components/reports/PatientReports'
import InventoryReports from '@/components/reports/InventoryReports'
import AppointmentReports from '@/components/reports/AppointmentReports'
import FinancialReports from '@/components/reports/FinancialReports'
import TreatmentReports from '@/components/reports/TreatmentReports'
import ClinicNeedsReports from '@/components/reports/ClinicNeedsReports'
import ComprehensiveProfitLossReport from '@/components/reports/ComprehensiveProfitLossReport'
import CurrencyDisplay from '@/components/ui/currency-display'
import { ComprehensiveExportService, TIME_PERIODS, TimePeriod } from '@/services/comprehensiveExportService'
import { useDentalTreatmentStore } from '@/store/dentalTreatmentStore'
import { usePrescriptionStore } from '@/store/prescriptionStore'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import RealTimeIndicator from '@/components/ui/real-time-indicator'
import TimeFilter from '@/components/ui/time-filter'
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'
import {
  BarChart3,
  Users,
  Calendar,
  DollarSign,
  Package,
  TrendingUp,
  Download,
  Filter,
  RefreshCw,
  FileText,
  PieChart,
  AlertTriangle,
  Stethoscope,
  ClipboardList,
  Clock,
  CheckCircle,
  Calculator

} from 'lucide-react'
import { notify } from '@/services/notificationService'

export default function Reports() {
  const { currency } = useSettingsStore()
  const { totalRevenue, pendingAmount, payments } = usePaymentStore()
  const { appointments } = useAppointmentStore()
  const { items: inventoryItems } = useInventoryStore()
  const { patients } = usePatientStore()
  const { needs: clinicNeeds, totalValue: clinicNeedsTotalValue } = useClinicNeedsStore()
  const { labOrders } = useLabOrderStore()
  const { toothTreatments } = useDentalTreatmentStore()
  const { prescriptions } = usePrescriptionStore()
  const {
    reportData,
    patientReports,
    appointmentReports,
    financialReports,
    inventoryReports,
    clinicNeedsReports,
    isLoading,
    isExporting,
    error,
    activeReportType,
    currentFilter,
    generateReport,
    generateAllReports,
    setActiveReportType,
    setFilter,
    exportReport,
    clearError
  } = useReportsStore()

  const [selectedTab, setSelectedTab] = useState('overview')

  // Comprehensive report state
  const [selectedPeriod, setSelectedPeriod] = useState<TimePeriod>('this_month')
  const [customStartDate, setCustomStartDate] = useState('')
  const [customEndDate, setCustomEndDate] = useState('')
  const [isComprehensiveExporting, setIsComprehensiveExporting] = useState(false)

  // Time filtering for different data types in overview (excluding patients)
  const appointmentStats = useTimeFilteredStats({
    data: appointments,
    dateField: 'start_time',
    initialFilter: { preset: 'all', startDate: '', endDate: '' }
  })

  const paymentStats = useTimeFilteredStats({
    data: payments,
    dateField: 'payment_date',
    initialFilter: { preset: 'all', startDate: '', endDate: '' }
  })

  const inventoryStats = useTimeFilteredStats({
    data: inventoryItems,
    dateField: 'created_at',
    initialFilter: { preset: 'all', startDate: '', endDate: '' }
  })

  // Time filtering for clinic needs
  const clinicNeedsStats = useTimeFilteredStats({
    data: clinicNeeds,
    dateField: 'created_at',
    initialFilter: { preset: 'all', startDate: '', endDate: '' }
  })

  useEffect(() => {
    // Load initial reports with fresh data
    console.log('üîÑ Loading initial reports...')
    clearError()
    generateAllReports()

    // Load ALL data for comprehensive reporting
    const loadAllData = async () => {
      try {
        const { loadAppointments } = useAppointmentStore.getState()
        const { loadPayments } = usePaymentStore.getState()
        const { loadItems } = useInventoryStore.getState()
        const { loadPatients } = usePatientStore.getState()
        const { loadNeeds } = useClinicNeedsStore.getState()
        const { loadLabOrders } = useLabOrderStore.getState()
        const { loadToothTreatments } = useDentalTreatmentStore.getState()
        const { loadPrescriptions } = usePrescriptionStore.getState()

        console.log('üîÑ Loading all data for comprehensive reports...')
        await Promise.all([
          loadAppointments(),
          loadPayments(),
          loadItems(),
          loadPatients(),
          loadNeeds(),
          loadLabOrders(),
          loadToothTreatments(),
          loadPrescriptions()
        ])
        console.log('‚úÖ All data loaded successfully for reports')
      } catch (error) {
        console.error('‚ùå Error loading data for reports:', error)
      }
    }

    loadAllData()
  }, [generateAllReports, clearError])

  useEffect(() => {
    if (error) {
      console.error('‚ùå Reports error:', error)
      // Show error notification
      const event = new CustomEvent('showToast', {
        detail: {
          title: 'ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±',
          description: error,
          type: 'error'
        }
      })
      window.dispatchEvent(event)
    }
  }, [error])

  const handleTabChange = async (value: string) => {
    setSelectedTab(value)
    setActiveReportType(value as any)

    // Load specific data based on tab and generate report
    try {
      if (value === 'treatments') {
        const { loadToothTreatments } = useDentalTreatmentStore.getState()
        const { loadPatients } = usePatientStore.getState()
        await Promise.all([loadToothTreatments(), loadPatients()])
      } else if (value === 'clinicNeeds') {
        const { loadNeeds } = useClinicNeedsStore.getState()
        await loadNeeds()
      } else if (value === 'inventory') {
        const { loadItems } = useInventoryStore.getState()
        await loadItems()
      } else if (value === 'financial') {
        const { loadPayments } = usePaymentStore.getState()
        const { loadLabOrders } = useLabOrderStore.getState()
        await Promise.all([loadPayments(), loadLabOrders()])
      } else if (value === 'patients') {
        const { loadPatients } = usePatientStore.getState()
        await loadPatients()
      } else if (value === 'appointments') {
        const { loadAppointments } = useAppointmentStore.getState()
        await loadAppointments()
      }

      // Generate specific report if not already loaded
      if (value !== 'overview') {
        await generateReport(value as any)
      }
    } catch (error) {
      console.error(`‚ùå Error loading data for ${value} tab:`, error)
    }
  }

  const handleRefresh = async () => {
    try {
      console.log('üîÑ Refreshing all reports and data...')
      clearError()

      // Refresh all data first
      const { loadAppointments } = useAppointmentStore.getState()
      const { loadPayments } = usePaymentStore.getState()
      const { loadItems } = useInventoryStore.getState()
      const { loadPatients } = usePatientStore.getState()
      const { loadNeeds } = useClinicNeedsStore.getState()
      const { loadLabOrders } = useLabOrderStore.getState()
      const { loadToothTreatments } = useDentalTreatmentStore.getState()
      const { loadPrescriptions } = usePrescriptionStore.getState()

      await Promise.all([
        loadAppointments(),
        loadPayments(),
        loadItems(),
        loadPatients(),
        loadNeeds(),
        loadLabOrders(),
        loadToothTreatments(),
        loadPrescriptions()
      ])

      // Then regenerate reports
      await generateAllReports()
      console.log('‚úÖ All reports and data refreshed successfully')
    } catch (error) {
      console.error('‚ùå Error refreshing reports:', error)
      throw error
    }
  }

  const handleExport = async (format: 'pdf' | 'excel' | 'csv') => {
    try {
      // Show loading message
      const loadingEvent = new CustomEvent('showToast', {
        detail: {
          title: 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿµÿØŸäÿ±... ‚è≥',
          description: `Ÿäÿ™ŸÖ ÿ™ÿ≠ÿ∂Ÿäÿ± ŸÖŸÑŸÅ ${format.toUpperCase()}`,
          type: 'info'
        }
      })
      window.dispatchEvent(loadingEvent)

      const result = await exportReport(activeReportType, {
        format,
        includeCharts: true,
        includeDetails: true,
        language: 'ar',
        orientation: 'landscape',
        pageSize: 'A4'
      })

      if (result?.success) {
        // Show success message with toast notification
        const event = new CustomEvent('showToast', {
          detail: {
            title: 'ÿ™ŸÖ ÿßŸÑÿ™ÿµÿØŸäÿ± ÿ®ŸÜÿ¨ÿßÿ≠! üéâ',
            description: `${result.message}\nÿ™ŸÖ ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸÑŸÅ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã`,
            type: 'success'
          }
        })
        window.dispatchEvent(event)
        console.log('ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿ®ŸÜÿ¨ÿßÿ≠:', result.filePath)
      } else {
        // Show error message
        const event = new CustomEvent('showToast', {
          detail: {
            title: 'ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿµÿØŸäÿ± ‚ùå',
            description: result?.message || 'ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±',
            type: 'error'
          }
        })
        window.dispatchEvent(event)
        console.error('ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±:', result?.message)
      }
    } catch (error) {
      console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±:', error)
    }
  }

  // Handle comprehensive export
  const handleComprehensiveExport = async () => {
    setIsComprehensiveExporting(true)
    try {
      // Ensure all data is loaded before export
      console.log('üîÑ Loading fresh data for comprehensive export...')
      const { loadAppointments } = useAppointmentStore.getState()
      const { loadPayments } = usePaymentStore.getState()
      const { loadItems } = useInventoryStore.getState()
      const { loadPatients } = usePatientStore.getState()
      const { loadNeeds } = useClinicNeedsStore.getState()
      const { loadLabOrders } = useLabOrderStore.getState()
      const { loadToothTreatments } = useDentalTreatmentStore.getState()
      const { loadPrescriptions } = usePrescriptionStore.getState()

      await Promise.all([
        loadAppointments(),
        loadPayments(),
        loadItems(),
        loadPatients(),
        loadNeeds(),
        loadLabOrders(),
        loadToothTreatments(),
        loadPrescriptions()
      ])

      console.log('‚úÖ All data loaded, starting export...')
      await ComprehensiveExportService.exportComprehensiveReport({
        patients,
        appointments,
        payments,
        inventory: inventoryItems,
        treatments: toothTreatments || [],
        prescriptions: prescriptions || [],
        labOrders: labOrders || [],
        clinicNeeds: clinicNeeds || [],
        timePeriod: selectedPeriod,
        customStartDate: selectedPeriod === 'custom' ? customStartDate : undefined,
        customEndDate: selectedPeriod === 'custom' ? customEndDate : undefined
      })

      // Success message
      const periodText = TIME_PERIODS[selectedPeriod]
      let successMessage = `ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ¥ÿßŸÖŸÑ ÿßŸÑŸÖŸÅÿµŸÑ ÿ®ŸÜÿ¨ÿßÿ≠!`
      successMessage += ` (${periodText})`

      const totalRecords = appointments.length + payments.length + (toothTreatments?.length || 0) +
                          (prescriptions?.length || 0) + (labOrders?.length || 0) + (clinicNeeds?.length || 0)

      successMessage += ` - ${totalRecords} ÿ≥ÿ¨ŸÑ ÿ•ÿ¨ŸÖÿßŸÑŸä`

      notify.exportSuccess(successMessage)
    } catch (error) {
      console.error('Error exporting comprehensive report:', error)
      notify.exportError('ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ¥ÿßŸÖŸÑ')
    } finally {
      setIsComprehensiveExporting(false)
    }
  }

  // Use real-time reports hook for automatic updates
  const { refreshReports } = useRealTimeReports(['overview'])

  // Use the store's auto-refresh functionality with shorter interval as backup
  useEffect(() => {
    const { startAutoRefresh, stopAutoRefresh } = useReportsStore.getState()

    // Start auto-refresh when component mounts with 1 minute interval as backup
    startAutoRefresh(1) // 1 minute interval as backup

    // Cleanup on unmount
    return () => {
      stopAutoRefresh()
    }
  }, [])

  // Update active report type when tab changes
  useEffect(() => {
    setActiveReportType(selectedTab as any)
  }, [selectedTab, setActiveReportType])



  const StatCard = ({
    title,
    value,
    icon: Icon,
    color = 'blue',
    trend,
    description
  }: {
    title: string
    value: string | number | React.ReactElement
    icon: any
    color?: string
    trend?: { value: number; isPositive: boolean }
    description?: string
  }) => (
    <Card className={getCardStyles(color)} dir="rtl">
      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
        <CardTitle className="text-sm font-medium text-muted-foreground text-right">
          {title}
        </CardTitle>
        <Icon className={`h-4 w-4 ${getIconStyles(color)}`} />
      </CardHeader>
      <CardContent>
        <div className="text-2xl font-bold text-foreground text-right">{value}</div>
        {trend && (
          <div className={`text-xs flex items-center justify-end mt-1 ${
            trend.isPositive ? 'text-green-600' : 'text-red-600'
          }`}>
            <span className="ml-1">{Math.abs(trend.value)}%</span>
            <TrendingUp className={`h-3 w-3 ${
              trend.isPositive ? '' : 'rotate-180'
            }`} />
          </div>
        )}
        {description && (
          <p className="text-xs text-muted-foreground mt-1 text-right">
            {description}
          </p>
        )}
      </CardContent>
    </Card>
  )

  return (
    <div className="space-y-6" dir="rtl">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <div className="flex items-center gap-3 mb-2">
            <h1 className="text-3xl font-bold text-foreground">ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ± ŸàÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™</h1>
            <RealTimeIndicator isActive={true} />
          </div>
          <p className="text-muted-foreground">
            ÿ™ŸÇÿßÿ±Ÿäÿ± ÿ¥ÿßŸÖŸÑÿ© ŸàŸÖŸÅÿµŸÑÿ© ŸÑÿ¨ŸÖŸäÿπ ÿ¨ŸàÿßŸÜÿ® ÿßŸÑÿπŸäÿßÿØÿ© - ÿ™ÿ≠ÿØŸäÿ´ ÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÅŸä ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÅÿπŸÑŸä
          </p>
        </div>

      </div>

      {/* Error Alert */}
      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4">
          <div className="flex items-center">
            <AlertTriangle className="h-5 w-5 text-red-600 ml-2" />
            <div>
              <h3 className="text-sm font-medium text-red-800">ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±</h3>
              <p className="text-sm text-red-700 mt-1">{error}</p>
            </div>
            <Button
              variant="ghost"
              size="sm"
              onClick={clearError}
              className="mr-auto"
            >
              ÿ•ÿ∫ŸÑÿßŸÇ
            </Button>
          </div>
        </div>
      )}

      {/* Loading State */}
      {isLoading && (
        <div className="flex items-center justify-center py-12">
          <div className="text-center">
            <RefreshCw className="h-8 w-8 animate-spin text-sky-600 mx-auto mb-4" />
            <p className="text-muted-foreground">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±...</p>
          </div>
        </div>
      )}

      {/* Reports Tabs */}
      <Tabs value={selectedTab} onValueChange={handleTabChange} className="space-y-6">
        <TabsList className="grid w-full grid-cols-7">
          <TabsTrigger value="overview" className="flex items-center space-x-2 space-x-reverse">
            <Calculator className="w-4 h-4" />
            <span>ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ¥ÿßŸÖŸÑ ÿßŸÑŸÖŸÅÿµŸÑ</span>
          </TabsTrigger>
          <TabsTrigger value="patients" className="flex items-center space-x-2 space-x-reverse">
            <Users className="w-4 h-4" />
            <span>ÿßŸÑŸÖÿ±ÿ∂Ÿâ</span>
          </TabsTrigger>
          <TabsTrigger value="appointments" className="flex items-center space-x-2 space-x-reverse">
            <Calendar className="w-4 h-4" />
            <span>ÿßŸÑŸÖŸàÿßÿπŸäÿØ</span>
          </TabsTrigger>
          <TabsTrigger value="financial" className="flex items-center space-x-2 space-x-reverse">
            <DollarSign className="w-4 h-4" />
            <span>ÿßŸÑŸÖÿßŸÑŸäÿ©</span>
          </TabsTrigger>
          <TabsTrigger value="treatments" className="flex items-center space-x-2 space-x-reverse">
            <Stethoscope className="w-4 h-4" />
            <span>ÿßŸÑÿπŸÑÿßÿ¨ÿßÿ™</span>
          </TabsTrigger>
          <TabsTrigger value="inventory" className="flex items-center space-x-2 space-x-reverse">
            <Package className="w-4 h-4" />
            <span>ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ</span>
          </TabsTrigger>
          <TabsTrigger value="clinicNeeds" className="flex items-center space-x-2 space-x-reverse">
            <ClipboardList className="w-4 h-4" />
            <span>ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ ÿßŸÑÿπŸäÿßÿØÿ©</span>
          </TabsTrigger>
        </TabsList>

        {/* Comprehensive Report Tab */}
        <TabsContent value="overview" className="space-y-6" dir="rtl">
          {/* Comprehensive Report Section - Main Content */}
          <div className="space-y-6" dir="rtl">
            {/* Header */}
            <div className="flex items-center justify-between">
              <div>
                <h2 className="text-2xl font-bold text-foreground flex items-center gap-3">
                  <Calculator className="w-6 h-6" />
                  ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ¥ÿßŸÖŸÑ ÿßŸÑŸÖŸÅÿµŸÑ
                </h2>
                <p className="text-muted-foreground mt-2 text-base">
                  ÿ™ŸÇÿ±Ÿäÿ± ÿ¥ÿßŸÖŸÑ Ÿäÿ∫ÿ∑Ÿä ÿ¨ŸÖŸäÿπ ÿ¨ŸàÿßŸÜÿ® ÿßŸÑÿπŸäÿßÿØÿ©: ÿßŸÑŸÖŸàÿßÿπŸäÿØÿå ÿßŸÑŸÖÿØŸÅŸàÿπÿßÿ™ÿå ÿßŸÑÿπŸÑÿßÿ¨ÿßÿ™ÿå ÿßŸÑŸàÿµŸÅÿßÿ™ÿå ÿßŸÑŸÖÿÆÿßÿ®ÿ±ÿå ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ÿå ŸàÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ ŸàÿßŸÑÿÆÿ≥ÿßÿ¶ÿ±
                </p>
              </div>
              <div className="flex items-center gap-2">
                <Button
                  variant="outline"
                  size="sm"
                  onClick={handleComprehensiveExport}
                  disabled={isComprehensiveExporting}
                  className="flex items-center gap-2"
                >
                  <Download className={`w-4 h-4 ${isComprehensiveExporting ? 'animate-bounce' : ''}`} />
                  {isComprehensiveExporting ? 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿµÿØŸäÿ±...' : 'ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±'}
                </Button>
              </div>
            </div>

            {/* Filter Section */}
            <Card className={getCardStyles("blue")}>
              <CardHeader>
                <CardTitle className="flex items-center gap-3">
                  <Filter className={`w-5 h-5 ${getIconStyles("blue")}`} />
                  ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±
                </CardTitle>
                <CardDescription>
                  ÿßÿÆÿ™ÿ± ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ© ŸÑŸÑÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ¥ÿßŸÖŸÑ
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  {/* Period Selection */}
                  <div className="space-y-2">
                    <Label htmlFor="period">ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ©</Label>
                    <Select value={selectedPeriod} onValueChange={(value: TimePeriod) => setSelectedPeriod(value)}>
                      <SelectTrigger>
                        <SelectValue placeholder="ÿßÿÆÿ™ÿ± ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ©" />
                      </SelectTrigger>
                      <SelectContent>
                        {Object.entries(TIME_PERIODS).map(([key, label]) => (
                          <SelectItem key={key} value={key}>
                            {label}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>

                  {/* Custom Date Range */}
                  {selectedPeriod === 'custom' && (
                    <>
                      <div className="space-y-2">
                        <Label htmlFor="startDate">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ®ÿØÿßŸäÿ©</Label>
                        <Input
                          id="startDate"
                          type="date"
                          value={customStartDate}
                          onChange={(e) => setCustomStartDate(e.target.value)}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="endDate">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÜŸáÿßŸäÿ©</Label>
                        <Input
                          id="endDate"
                          type="date"
                          value={customEndDate}
                          onChange={(e) => setCustomEndDate(e.target.value)}
                        />
                      </div>
                    </>
                  )}
                </div>
              </CardContent>
            </Card>

            {/* Report Preview Cards */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <Card className={getCardStyles("green")}>
                <CardContent className="p-4">
                  <div className="flex items-center gap-3">
                    <TrendingUp className={`w-8 h-8 ${getIconStyles("green")}`} />
                    <div>
                      <p className="text-sm text-muted-foreground">ÿßŸÑŸÖÿ±ÿ∂Ÿâ</p>
                      <p className="text-xl font-bold">{patients.length}</p>
                    </div>
                  </div>
                </CardContent>
              </Card>

              <Card className={getCardStyles("blue")}>
                <CardContent className="p-4">
                  <div className="flex items-center gap-3">
                    <Calendar className={`w-8 h-8 ${getIconStyles("blue")}`} />
                    <div>
                      <p className="text-sm text-muted-foreground">ÿßŸÑŸÖŸàÿßÿπŸäÿØ</p>
                      <p className="text-xl font-bold">{appointments.length}</p>
                    </div>
                  </div>
                </CardContent>
              </Card>

              <Card className={getCardStyles("purple")}>
                <CardContent className="p-4">
                  <div className="flex items-center gap-3">
                    <FileText className={`w-8 h-8 ${getIconStyles("purple")}`} />
                    <div>
                      <p className="text-sm text-muted-foreground">ÿßŸÑŸÖÿØŸÅŸàÿπÿßÿ™</p>
                      <p className="text-xl font-bold">{payments.length}</p>
                    </div>
                  </div>
                </CardContent>
              </Card>

              <Card className={getCardStyles("orange")}>
                <CardContent className="p-4">
                  <div className="flex items-center gap-3">
                    <Calculator className={`w-8 h-8 ${getIconStyles("orange")}`} />
                    <div>
                      <p className="text-sm text-muted-foreground">ÿßŸÑÿπŸÑÿßÿ¨ÿßÿ™</p>
                      <p className="text-xl font-bold">{toothTreatments?.length || 0}</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* Additional Stats */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <Card className={getCardStyles("cyan")}>
                <CardContent className="p-4">
                  <div className="flex items-center gap-3">
                    <FileText className={`w-8 h-8 ${getIconStyles("cyan")}`} />
                    <div>
                      <p className="text-sm text-muted-foreground">ÿßŸÑŸàÿµŸÅÿßÿ™</p>
                      <p className="text-xl font-bold">{prescriptions?.length || 0}</p>
                    </div>
                  </div>
                </CardContent>
              </Card>

              <Card className={getCardStyles("indigo")}>
                <CardContent className="p-4">
                  <div className="flex items-center gap-3">
                    <FileText className={`w-8 h-8 ${getIconStyles("indigo")}`} />
                    <div>
                      <p className="text-sm text-muted-foreground">ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÖÿÆÿßÿ®ÿ±</p>
                      <p className="text-xl font-bold">{labOrders?.length || 0}</p>
                    </div>
                  </div>
                </CardContent>
              </Card>

              <Card className={getCardStyles("indigo")}>
                <CardContent className="p-4">
                  <div className="flex items-center gap-3">
                    <ClipboardList className={`w-8 h-8 ${getIconStyles("indigo")}`} />
                    <div>
                      <p className="text-sm text-muted-foreground">ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ ÿßŸÑÿπŸäÿßÿØÿ©</p>
                      <p className="text-xl font-bold">{clinicNeeds?.length || 0}</p>
                    </div>
                  </div>
                </CardContent>
              </Card>

              <Card className={getCardStyles("gray")}>
                <CardContent className="p-4">
                  <div className="flex items-center gap-3">
                    <FileText className={`w-8 h-8 ${getIconStyles("gray")}`} />
                    <div>
                      <p className="text-sm text-muted-foreground">ÿπŸÜÿßÿµÿ± ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ</p>
                      <p className="text-xl font-bold">{inventoryItems.length}</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* Report Description */}
            <Card>
              <CardHeader>
                <CardTitle>ŸÖÿ≠ÿ™ŸàŸäÿßÿ™ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ¥ÿßŸÖŸÑ</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                  <div>
                    <h4 className="font-semibold mb-2">ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿßŸÑŸä:</h4>
                    <ul className="space-y-1 text-muted-foreground">
                      <li>‚Ä¢ ÿßŸÑŸÖÿØŸÅŸàÿπÿßÿ™ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ© ŸàÿßŸÑÿ¨ÿ≤ÿ¶Ÿäÿ©</li>
                      <li>‚Ä¢ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•Ÿäÿ±ÿßÿØÿßÿ™ ŸàÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™</li>
                      <li>‚Ä¢ ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ ŸàÿßŸÑÿÆÿ≥ÿßÿ¶ÿ±</li>
                      <li>‚Ä¢ ÿßŸÑŸÖÿ®ÿßŸÑÿ∫ ÿßŸÑŸÖÿ™ÿ®ŸÇŸäÿ© ŸàÿßŸÑŸÖÿπŸÑŸÇÿ©</li>
                    </ul>
                  </div>
                  <div>
                    <h4 className="font-semibold mb-2">ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ∑ÿ®Ÿä:</h4>
                    <ul className="space-y-1 text-muted-foreground">
                      <li>‚Ä¢ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÖŸàÿßÿπŸäÿØ ŸàÿßŸÑÿ≠ÿ∂Ÿàÿ±</li>
                      <li>‚Ä¢ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿπŸÑÿßÿ¨ÿßÿ™ ŸàÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤</li>
                      <li>‚Ä¢ ÿßŸÑŸàÿµŸÅÿßÿ™ ŸàÿßŸÑÿ£ÿØŸàŸäÿ©</li>
                      <li>‚Ä¢ ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÖÿÆÿßÿ®ÿ± ŸàÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨</li>
                    </ul>
                  </div>
                  <div>
                    <h4 className="font-semibold mb-2">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿπŸäÿßÿØÿ©:</h4>
                    <ul className="space-y-1 text-muted-foreground">
                      <li>‚Ä¢ ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ ÿßŸÑÿπŸäÿßÿØÿ© ŸàÿßŸÑÿ£ŸàŸÑŸàŸäÿßÿ™</li>
                      <li>‚Ä¢ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ ŸàÿßŸÑŸÖÿ≥ÿ™ŸÑÿ≤ŸÖÿßÿ™</li>
                      <li>‚Ä¢ ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ£ÿØÿßÿ° ŸàÿßŸÑŸÉŸÅÿßÿ°ÿ©</li>
                      <li>‚Ä¢ ÿßŸÑÿ™ŸàŸÇŸäÿ™ÿßÿ™ ŸàÿßŸÑÿ∞ÿ±Ÿàÿßÿ™</li>
                    </ul>
                  </div>
                  <div>
                    <h4 className="font-semibold mb-2">ÿ™ÿ≠ŸÑŸäŸÑÿßÿ™ ŸÖÿ™ŸÇÿØŸÖÿ©:</h4>
                    <ul className="space-y-1 text-muted-foreground">
                      <li>‚Ä¢ ÿ£ŸÉÿ´ÿ± ÿßŸÑÿπŸÑÿßÿ¨ÿßÿ™ ÿ∑ŸÑÿ®ÿßŸã</li>
                      <li>‚Ä¢ ÿ£ŸÉÿ´ÿ± ÿßŸÑŸÖÿÆÿßÿ®ÿ± ÿßÿ≥ÿ™ÿÆÿØÿßŸÖÿßŸã</li>
                      <li>‚Ä¢ ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑÿ£ŸàŸÇÿßÿ™ ŸàÿßŸÑÿ£ŸäÿßŸÖ</li>
                      <li>‚Ä¢ ŸÖÿπÿØŸÑÿßÿ™ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ ŸàÿßŸÑŸÜÿ¨ÿßÿ≠</li>
                    </ul>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>

          {/* Time Filters Section - Secondary */}
          <div className="space-y-4" dir="rtl">
            <h3 className="text-lg font-semibold text-foreground flex items-center gap-2">
              <Filter className="w-5 h-5" />
              ŸÅŸÑÿßÿ™ÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ŸÅÿµŸäŸÑŸäÿ©
            </h3>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <TimeFilter
                value={appointmentStats.timeFilter}
                onChange={appointmentStats.handleFilterChange}
                onClear={appointmentStats.resetFilter}
                title="ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑŸÖŸàÿßÿπŸäÿØ"
                defaultOpen={false}
              />
              <TimeFilter
                value={paymentStats.timeFilter}
                onChange={paymentStats.handleFilterChange}
                onClear={paymentStats.resetFilter}
                title="ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑŸÖÿØŸÅŸàÿπÿßÿ™"
                defaultOpen={false}
              />
              <TimeFilter
                value={inventoryStats.timeFilter}
                onChange={inventoryStats.handleFilterChange}
                onClear={inventoryStats.resetFilter}
                title="ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ"
                defaultOpen={false}
              />
              <TimeFilter
                value={clinicNeedsStats.timeFilter}
                onChange={clinicNeedsStats.handleFilterChange}
                onClear={clinicNeedsStats.resetFilter}
                title="ŸÅŸÑÿ™ÿ±ÿ© ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ ÿßŸÑÿπŸäÿßÿØÿ©"
                defaultOpen={false}
              />
            </div>
          </div>

          {/* Stats Cards with Filtered Data */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6" dir="rtl">
            <StatCard
              title="ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ±ÿ∂Ÿâ"
              value={patientReports?.totalPatients || 0}
              icon={Users}
              color="blue"
              description="ÿßŸÑÿπÿØÿØ ÿßŸÑŸÉŸÑŸä ŸÑŸÑŸÖÿ±ÿ∂Ÿâ ÿßŸÑŸÖÿ≥ÿ¨ŸÑŸäŸÜ"
            />
            <StatCard
              title="ÿßŸÑŸÖŸàÿßÿπŸäÿØ"
              value={appointmentStats.filteredData.length}
              icon={Calendar}
              color="purple"
              trend={appointmentStats.trend}
              description={`ŸÖŸÜ ÿ•ÿ¨ŸÖÿßŸÑŸä ${appointmentReports?.totalAppointments || 0} ŸÖŸàÿπÿØ`}
            />
            <StatCard
              title="ÿßŸÑÿ•Ÿäÿ±ÿßÿØÿßÿ™"
              value={<CurrencyDisplay amount={paymentStats.financialStats.totalRevenue || 0} currency={currency} />}
              icon={DollarSign}
              color="green"
              trend={paymentStats.trend}
              description={`ŸÖŸÜ ÿ•ÿ¨ŸÖÿßŸÑŸä ${formatCurrency(totalRevenue || 0, currency)}`}
            />
            <StatCard
              title="ÿπŸÜÿßÿµÿ± ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ"
              value={inventoryStats.filteredData.length}
              icon={Package}
              color="orange"
              trend={inventoryStats.trend}
              description={`ŸÖŸÜ ÿ•ÿ¨ŸÖÿßŸÑŸä ${inventoryReports?.totalItems || 0} ÿπŸÜÿµÿ±`}
            />
            <StatCard
              title="ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ ÿßŸÑÿπŸäÿßÿØÿ©"
              value={clinicNeedsStats.filteredData.length}
              icon={ClipboardList}
              color="indigo"
              trend={clinicNeedsStats.trend}
              description={`ŸÖŸÜ ÿ•ÿ¨ŸÖÿßŸÑŸä ${clinicNeedsReports?.totalNeeds || 0} ÿßÿ≠ÿ™Ÿäÿßÿ¨`}
            />
          </div>

          {/* Quick Stats Table */}
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6" dir="rtl">
            <Card dir="rtl">
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <BarChart3 className="h-5 w-5 text-primary" />
                  ŸÖŸÑÿÆÿµ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÅŸÑÿ™ÿ±ÿ©
                </CardTitle>
                <CardDescription>ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÖŸÅŸÑÿ™ÿ±ÿ© ÿ≠ÿ≥ÿ® ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©</CardDescription>
              </CardHeader>
              <CardContent>
                <div className="border rounded-lg overflow-hidden" dir="rtl">
                  <Table dir="rtl">
                    <TableHeader>
                      <TableRow className="bg-muted/50">
                        <TableHead className="text-right">
                          <span className="arabic-enhanced font-medium">ÿßŸÑÿ®ŸäÿßŸÜ</span>
                        </TableHead>
                        <TableHead className="text-center">
                          <span className="arabic-enhanced font-medium">ÿßŸÑŸÇŸäŸÖÿ©</span>
                        </TableHead>
                        <TableHead className="text-center">
                          <span className="arabic-enhanced font-medium">ÿßŸÑÿ≠ÿßŸÑÿ©</span>
                        </TableHead>
                      </TableRow>
                    </TableHeader>
                    <TableBody>
                      <TableRow className="hover:bg-muted/50">
                        <TableCell className="font-medium text-right table-cell-wrap-truncate-md">
                          <div className="flex items-center gap-2 justify-end">
                            <span className="arabic-enhanced">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ±ÿ∂Ÿâ</span>
                            <Users className="h-4 w-4 text-blue-500" />
                          </div>
                        </TableCell>
                        <TableCell className="text-center font-bold">
                          {patientReports?.totalPatients || 0}
                        </TableCell>
                        <TableCell className="text-center">
                          <Badge variant="secondary" className="arabic-enhanced">
                            {(patientReports?.totalPatients || 0) > 0 ? 'ŸÜÿ¥ÿ∑' : 'ŸÖŸÜÿÆŸÅÿ∂'}
                          </Badge>
                        </TableCell>
                      </TableRow>
                      <TableRow className="hover:bg-muted/50">
                        <TableCell className="font-medium text-right table-cell-wrap-truncate-md">
                          <div className="flex items-center gap-2 justify-end">
                            <span className="arabic-enhanced">ÿßŸÑŸÖŸàÿßÿπŸäÿØ</span>
                            <Calendar className="h-4 w-4 text-purple-500" />
                          </div>
                        </TableCell>
                        <TableCell className="text-center font-bold">
                          {appointmentStats.filteredData.length}
                        </TableCell>
                        <TableCell className="text-center">
                          <Badge
                            variant={appointmentStats.filteredData.length > 0 ? "default" : "secondary"}
                            className="arabic-enhanced"
                          >
                            {appointmentStats.filteredData.length > 0 ? 'ŸÜÿ¥ÿ∑' : 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸàÿßÿπŸäÿØ'}
                          </Badge>
                        </TableCell>
                      </TableRow>
                      <TableRow className="hover:bg-muted/50">
                        <TableCell className="font-medium text-right table-cell-wrap-truncate-md">
                          <div className="flex items-center gap-2 justify-end">
                            <span className="arabic-enhanced">ÿßŸÑÿ•Ÿäÿ±ÿßÿØÿßÿ™ ÿßŸÑŸÖŸÅŸÑÿ™ÿ±ÿ©</span>
                            <DollarSign className="h-4 w-4 text-green-500" />
                          </div>
                        </TableCell>
                        <TableCell className="text-center font-bold table-cell-wrap-truncate-sm">
                          <CurrencyDisplay amount={paymentStats.financialStats.totalRevenue || 0} currency={currency} />
                        </TableCell>
                        <TableCell className="text-center">
                          <Badge
                            variant={(paymentStats.financialStats.totalRevenue || 0) > 0 ? "default" : "secondary"}
                            className="arabic-enhanced"
                          >
                            {(paymentStats.financialStats.totalRevenue || 0) > 0 ? 'ÿ•Ÿäÿ±ÿßÿØÿßÿ™ ŸÖÿ™ÿßÿ≠ÿ©' : 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•Ÿäÿ±ÿßÿØÿßÿ™'}
                          </Badge>
                        </TableCell>
                      </TableRow>
                      <TableRow className="hover:bg-muted/50">
                        <TableCell className="font-medium text-right table-cell-wrap-truncate-md">
                          <div className="flex items-center gap-2 justify-end">
                            <span className="arabic-enhanced">ÿßŸÑŸÖÿØŸÅŸàÿπÿßÿ™ ÿßŸÑŸÖÿπŸÑŸÇÿ© ÿßŸÑŸÖŸÅŸÑÿ™ÿ±ÿ©</span>
                            <DollarSign className="h-4 w-4 text-red-500" />
                          </div>
                        </TableCell>
                        <TableCell className="text-center font-bold table-cell-wrap-truncate-sm">
                          <CurrencyDisplay amount={paymentStats.financialStats.pendingAmount || 0} currency={currency} />
                        </TableCell>
                        <TableCell className="text-center">
                          <Badge
                            variant={(paymentStats.financialStats.pendingAmount || 0) > 0 ? "destructive" : "default"}
                            className="arabic-enhanced"
                          >
                            {(paymentStats.financialStats.pendingAmount || 0) > 0 ? 'Ÿäÿ™ÿ∑ŸÑÿ® ŸÖÿ™ÿßÿ®ÿπÿ©' : 'ŸÖŸÉÿ™ŸÖŸÑ'}
                          </Badge>
                        </TableCell>
                      </TableRow>
                      <TableRow className="hover:bg-muted/50">
                        <TableCell className="font-medium text-right table-cell-wrap-truncate-md">
                          <div className="flex items-center gap-2 justify-end">
                            <span className="arabic-enhanced">ÿπŸÜÿßÿµÿ± ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ</span>
                            <Package className="h-4 w-4 text-orange-500" />
                          </div>
                        </TableCell>
                        <TableCell className="text-center font-bold">
                          {inventoryStats.filteredData.length}
                        </TableCell>
                        <TableCell className="text-center">
                          <Badge
                            variant={inventoryStats.filteredData.length > 0 ? "default" : "secondary"}
                            className="arabic-enhanced"
                          >
                            {inventoryStats.filteredData.length > 0 ? 'ŸÖÿ™ŸàŸÅÿ±' : 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿπŸÜÿßÿµÿ±'}
                          </Badge>
                        </TableCell>
                      </TableRow>
                      <TableRow className="hover:bg-muted/50">
                        <TableCell className="font-medium text-right table-cell-wrap-truncate-md">
                          <div className="flex items-center gap-2 justify-end">
                            <span className="arabic-enhanced">ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ ÿßŸÑÿπŸäÿßÿØÿ©</span>
                            <ClipboardList className="h-4 w-4 text-indigo-500" />
                          </div>
                        </TableCell>
                        <TableCell className="text-center font-bold">
                          {clinicNeedsStats.filteredData.length}
                        </TableCell>
                        <TableCell className="text-center">
                          <Badge
                            variant={clinicNeedsStats.filteredData.length > 0 ? "default" : "secondary"}
                            className="arabic-enhanced"
                          >
                            {clinicNeedsStats.filteredData.length > 0 ? 'ŸäŸàÿ¨ÿØ ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™' : 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™'}
                          </Badge>
                        </TableCell>
                      </TableRow>
                      <TableRow className="hover:bg-muted/50">
                        <TableCell className="font-medium text-right table-cell-wrap-truncate-md">
                          <div className="flex items-center gap-2 justify-end">
                            <span className="arabic-enhanced">ŸÇŸäŸÖÿ© ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ ÿßŸÑÿπŸäÿßÿØÿ©</span>
                            <DollarSign className="h-4 w-4 text-indigo-500" />
                          </div>
                        </TableCell>
                        <TableCell className="text-center font-bold table-cell-wrap-truncate-sm">
                          <CurrencyDisplay
                            amount={clinicNeedsStats.filteredData.reduce((total, need) => total + (need.total_cost || 0), 0)}
                            currency={currency}
                          />
                        </TableCell>
                        <TableCell className="text-center">
                          <Badge
                            variant={clinicNeedsStats.filteredData.reduce((total, need) => total + (need.total_cost || 0), 0) > 0 ? "default" : "secondary"}
                            className="arabic-enhanced"
                          >
                            {clinicNeedsStats.filteredData.reduce((total, need) => total + (need.total_cost || 0), 0) > 0 ? 'ŸÇŸäŸÖÿ© ŸÖÿ™ÿßÿ≠ÿ©' : 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÇŸäŸÖÿ©'}
                          </Badge>
                        </TableCell>
                      </TableRow>
                    </TableBody>
                  </Table>
                </div>
              </CardContent>
            </Card>

            {/* Clinic Needs Summary Card */}
            <Card className={getCardStyles("indigo")} dir="rtl">
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <ClipboardList className={`h-5 w-5 ${getIconStyles("indigo")}`} />
                  ŸÖŸÑÿÆÿµ ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ ÿßŸÑÿπŸäÿßÿØÿ©
                </CardTitle>
                <CardDescription>ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÖŸÅÿµŸÑÿ© ÿπŸÜ ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ ÿßŸÑÿπŸäÿßÿØÿ© ÿßŸÑŸÖŸÅŸÑÿ™ÿ±ÿ©</CardDescription>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  <div className="grid grid-cols-2 gap-4">
                    <div className={`text-center p-4 ${getCardStyles('blue')} transition-all duration-200`}>
                      <div className="flex items-center justify-center gap-2 mb-2">
                        <Clock className={`h-4 w-4 ${getIconStyles('blue')}`} />
                      </div>
                      <div className="text-2xl font-bold text-foreground">
                        {clinicNeedsStats.filteredData.filter(need => need.status === 'pending').length}
                      </div>
                      <div className="text-xs font-medium text-muted-foreground mt-1">ŸÖÿπŸÑŸÇÿ©</div>
                    </div>
                    <div className={`text-center p-4 ${getCardStyles('green')} transition-all duration-200`}>
                      <div className="flex items-center justify-center gap-2 mb-2">
                        <CheckCircle className={`h-4 w-4 ${getIconStyles('green')}`} />
                      </div>
                      <div className="text-2xl font-bold text-foreground">
                        {clinicNeedsStats.filteredData.filter(need => need.status === 'received').length}
                      </div>
                      <div className="text-xs font-medium text-muted-foreground mt-1">ŸÖÿ≥ÿ™ŸÑŸÖÿ©</div>
                    </div>
                    <div className={`text-center p-4 ${getCardStyles('red')} transition-all duration-200`}>
                      <div className="flex items-center justify-center gap-2 mb-2">
                        <AlertTriangle className={`h-4 w-4 ${getIconStyles('red')}`} />
                      </div>
                      <div className="text-2xl font-bold text-foreground">
                        {clinicNeedsStats.filteredData.filter(need => need.priority === 'urgent').length}
                      </div>
                      <div className="text-xs font-medium text-muted-foreground mt-1">ÿπÿßÿ¨ŸÑÿ©</div>
                    </div>
                    <div className={`text-center p-4 ${getCardStyles('emerald')} transition-all duration-200`}>
                      <div className="flex items-center justify-center gap-2 mb-2">
                        <DollarSign className={`h-4 w-4 ${getIconStyles('emerald')}`} />
                      </div>
                      <div className="text-lg font-bold text-foreground">
                        <CurrencyDisplay
                          amount={clinicNeedsStats.filteredData.reduce((total, need) => total + (need.total_cost || 0), 0)}
                          currency={currency}
                          className="text-lg font-bold"
                        />
                      </div>
                      <div className="text-xs font-medium text-muted-foreground mt-1">ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©</div>
                    </div>
                  </div>

                  {/* Progress indicators */}
                  <div className={`space-y-3 p-4 ${getCardStyles('gray')} transition-all duration-200`}>
                    <div className="flex justify-between items-center text-sm font-medium">
                      <span className="text-foreground">ŸÖÿπÿØŸÑ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤</span>
                      <span className={`font-bold ${getIconStyles('green')}`}>
                        {clinicNeedsStats.filteredData.length > 0 ? Math.round((clinicNeedsStats.filteredData.filter(need => need.status === 'received').length / clinicNeedsStats.filteredData.length) * 100) : 0}%
                      </span>
                    </div>
                    <div className="w-full bg-muted rounded-full h-3 shadow-inner">
                      <div
                        className={`bg-gradient-to-r from-green-500 to-green-600 dark:from-green-400 dark:to-green-500 h-3 rounded-full transition-all duration-500 ease-out shadow-sm`}
                        style={{
                          width: `${clinicNeedsStats.filteredData.length > 0 ? (clinicNeedsStats.filteredData.filter(need => need.status === 'received').length / clinicNeedsStats.filteredData.length) * 100 : 0}%`
                        }}
                      ></div>
                    </div>
                    <div className="flex justify-between text-xs text-muted-foreground">
                      <span>ŸÖÿ≥ÿ™ŸÑŸÖÿ©: {clinicNeedsStats.filteredData.filter(need => need.status === 'received').length}</span>
                      <span>ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä: {clinicNeedsStats.filteredData.length}</span>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>

          </div>

        </TabsContent>

        {/* Patient Reports Tab */}
        <TabsContent value="patients" dir="rtl">
          <PatientReports />
        </TabsContent>

        <TabsContent value="appointments" dir="rtl">
          <AppointmentReports />
        </TabsContent>

        <TabsContent value="financial" dir="rtl">
          <FinancialReports />
        </TabsContent>

        <TabsContent value="treatments" dir="rtl">
          <TreatmentReports />
        </TabsContent>

        <TabsContent value="inventory" dir="rtl">
          <InventoryReports />
        </TabsContent>

        <TabsContent value="clinicNeeds" dir="rtl">
          <ClinicNeedsReports />
        </TabsContent>
      </Tabs>
    </div>
  )
}
